<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <link rel='stylesheet' href='stylesheets/style.css' />

    
    <script src="https://cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js%22%3E"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    

    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Graph display</title>
</head>

<script>
    var dynamicColors = function(string) {
                            var r = Math.floor(Math.random() * 255);
                            var g = Math.floor(Math.random() * 255);
                            var b = Math.floor(Math.random() * 255);
                            
                                return "rgba(" + r + ", " + g + ", " + b + ", 0.75)";
                        }
    const countOccurrences = (arr, val) => arr.reduce((a, v) => (v === val ? a + 1 : a), 0);
</script>

<nav class="navbar navbar-expand-xl navbar-dark bg-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">CAPDEV</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link" href="/">Input</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="/database">Database</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" aria-current="page" href="/graphs">Graph display</a>
                </li>
        </div>
    </div>
</nav>


<body>
    <div class = "graphs">
        <div class = "row">
            <div class="col-6 chart">
                <div class ="chart">
                    <canvas id="myChart" width="400" height="400"></canvas>
                </div>
                <script>
                    
                
                    var jsondata = JSON.parse('<%- results %>');
                    
                    var len = Object.keys(jsondata).length;

                    var titlearr = []; // holds title of each project
                    var costarr = []; // holds the cost of each project
                    var backarr = [];
                    var borderarr = [];

                    for(let i = 11; i < len; ++i) {
                        titlearr.push(jsondata[i].title);
                        costarr.push(jsondata[i].cost);
                    }
                    for(let i = 0; i < titlearr.length; ++i) {
                            backarr.push(dynamicColors())
                            borderarr.push(backarr[i].replace("0.2", "1.0"));
                        }
                    
                    
                    var ctx = document.getElementById('myChart');
                    var myChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: titlearr,
                            datasets: [{
                                label: 'Cost per project',
                                data: costarr,
                                backgroundColor: backarr,
                                borderColor: borderarr,
                                borderWidth: 1
                            }]
                        },
                        options: {
                            scales: {
                                y: {
                                    beginAtZero: true
                                }
                            },
                            legend:{
                                position: 'right'
                            }
                        }
                    });
                    </script>
                </div>
                <div class="col-6 chart">
                    <div class = "chart">
                        <canvas id="myChart2" width="400" height="400"></canvas>
                    </div>
                    <script>
                        

                        var jsondata = JSON.parse('<%- results %>');
                    
                        var len = Object.keys(jsondata).length;

                        var titlearr = []; // holds the title of resource sponsors
                        var countarr = []; // holds all occurences of all resource sponsors
                        var occarr = []; // holds the occurences of each resource sponsor
                        var backarr = [];
                        var borderarr = [];
                        

                        

                        for(let i = 11; i < len; ++i) {
                            if(this.titlearr.indexOf(jsondata[i].resourcesponsor) === -1) {
                            this.titlearr.push(jsondata[i].resourcesponsor);
                            }
                            countarr.push(jsondata[i].resourcesponsor);
                            
                        }


                        for(let i = 0; i < titlearr.length; ++i) {
                            occarr.push(countOccurrences(countarr, countarr[i]));
                            backarr.push(dynamicColors())
                            borderarr.push(backarr[i].replace("0.2", "1.0"));
                        }

                        var ctx = document.getElementById('myChart2');
                        var myChart2 = new Chart(ctx, {
                            type: 'pie',
                            data: {
                                labels: titlearr,
                                datasets: [{
                                    label: 'Projects per resource sponsor',
                                    data: occarr,
                                    backgroundColor: backarr,
                                    borderColor: borderarr,
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                },
                                legend:{
                                    position: 'right'
                                }
                            }
                        });
                    </script>
                </div>
            </div>
            <div class= "row">
                <div class="col-6 chart">
                    <div class ="chart">
                        <canvas id="myChart3" width="400" height="400"></canvas>
                    </div>
                    <script>
                        var ctx = document.getElementById('myChart3');
                        var myChart3 = new Chart(ctx, {
                            type: 'line',
                            data: {
                                labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                                datasets: [{
                                    label: '# of Votes',
                                    data: [12, 19, 3, 5, 2, 3],
                                    backgroundColor: [
                                        'rgba(255, 99, 132, 0.2)',
                                        'rgba(54, 162, 235, 0.2)',
                                        'rgba(255, 206, 86, 0.2)',
                                        'rgba(75, 192, 192, 0.2)',
                                        'rgba(153, 102, 255, 0.2)',
                                        'rgba(255, 159, 64, 0.2)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 99, 132, 1)',
                                        'rgba(54, 162, 235, 1)',
                                        'rgba(255, 206, 86, 1)',
                                        'rgba(75, 192, 192, 1)',
                                        'rgba(153, 102, 255, 1)',
                                        'rgba(255, 159, 64, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                scales: {
                                    y: {
                                        beginAtZero: true
                                    }
                                },
                                legend:{
                                    position: 'right'
                                }
                            }
                        });
                    </script>
                </div>
        </div>
    </div>
    
</body>

</html>